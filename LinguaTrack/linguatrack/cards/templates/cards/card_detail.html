{% extends 'cards/base.html' %}

{% block title %}{{ card.word }} - LinguaTrack{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2 class="mb-0">{{ card.word }}</h2>
                <div>
                    <span class="badge bg-secondary">{{ card.get_difficulty_display }}</span>
                    {% if card.is_learned %}
                        <span class="badge bg-success">–í—ã—É—á–µ–Ω–æ ‚úì</span>
                    {% elif card.is_due %}
                        <span class="badge bg-warning">–ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—é ‚è∞</span>
                    {% endif %}
                </div>
            </div>
            <div class="card-body">
                <h4 class="text-primary mb-3">{{ card.translation }}</h4>

                <!-- –ê—É–¥–∏–æ -->
                <div class="mb-3">
                    {% if has_audio %}
                        <button onclick="playAudio({{ card.pk }})" class="btn btn-outline-primary">
                            üîä –û–∑–≤—É—á–∏—Ç—å —Å–ª–æ–≤–æ
                        </button>
                        <audio id="audio-{{ card.pk }}" preload="none">
                            <source src="{% url 'cards:play_audio' card.pk %}" type="audio/mpeg">
                        </audio>
                    {% else %}
                        <a href="{% url 'cards:generate_audio' card.pk %}" class="btn btn-outline-secondary">
                            üéµ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ
                        </a>
                    {% endif %}
                </div>

                {% if card.example %}
                    <div class="mb-3">
                        <strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong>
                        <p class="text-muted">{{ card.example }}</p>
                    </div>
                {% endif %}

                {% if card.note %}
                    <div class="mb-3">
                        <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong>
                        <p class="text-muted">{{ card.note }}</p>
                    </div>
                {% endif %}

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑—É—á–µ–Ω–∏—è -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="border rounded p-3">
                            <div class="d-flex justify-content-between">
                                <span>–ò–∑—É—á–µ–Ω–∞:</span>
                                <span class="fw-bold">{{ card.times_studied }} —Ä–∞–∑</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>–¢–æ—á–Ω–æ—Å—Ç—å:</span>
                                <span class="fw-bold text-success">{{ card.accuracy_rate }}%</span>
                            </div>
                        </div>
                    </div>

                    {% if schedule %}
                        <div class="col-md-6">
                            <div class="border rounded p-3">
                                <div class="d-flex justify-content-between">
                                    <span>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π:</span>
                                    <span class="fw-bold">{{ schedule.repetitions }}</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–ò–Ω—Ç–µ—Ä–≤–∞–ª:</span>
                                    <span class="fw-bold">{{ schedule.interval }} –¥–Ω.</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–°–ª–µ–¥—É—é—â–µ–µ:</span>
                                    <span class="{% if is_due %}text-warning fw-bold{% endif %}">
                                        {% if is_due %}
                                            –°–µ–π—á–∞—Å
                                        {% else %}
                                            {{ next_review|date:"d.m H:i" }}
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <div class="row text-muted">
                    <div class="col-sm-6">
                        <small>–°–æ–∑–¥–∞–Ω–æ: {{ card.created_at|date:"d.m.Y H:i" }}</small>
                    </div>
                    <div class="col-sm-6">
                        <small>–ò–∑–º–µ–Ω–µ–Ω–æ: {{ card.updated_at|date:"d.m.Y H:i" }}</small>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <a href="{% url 'cards:card_edit' card.pk %}" class="btn btn-warning">
                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </a>
                <a href="{% url 'cards:card_delete' card.pk %}" class="btn btn-danger">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                </a>
                <a href="{% url 'cards:card_list' %}" class="btn btn-secondary">
                    ‚¨ÖÔ∏è –ö —Å–ø–∏—Å–∫—É
                </a>
                {% if is_due %}
                    <a href="{% url 'cards:smart_study' %}" class="btn btn-primary">
                        üß† –ò–∑—É—á–∞—Ç—å
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–∑—É—á–µ–Ω–∏—è -->
        {% if recent_sessions %}
            <div class="card">
                <div class="card-header">
                    <h5>üìà –ò—Å—Ç–æ—Ä–∏—è –∏–∑—É—á–µ–Ω–∏—è</h5>
                </div>
                <div class="card-body">
                    {% for session in recent_sessions %}
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <span class="badge
                                    {% if session.result == 'perfect' %}bg-success
                                    {% elif session.result == 'correct' %}bg-info
                                    {% elif session.result == 'hard' %}bg-warning
                                    {% else %}bg-danger{% endif %}">
                                    {{ session.get_result_display }}
                                </span>
                                {% if session.user_answer %}
                                    <small class="text-muted d-block">{{ session.user_answer }}</small>
                                {% endif %}
                            </div>
                            <small class="text-muted">{{ session.created_at|date:"d.m H:i" }}</small>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    </div>
</div>

<script>
function playAudio(cardId) {
    const audio = document.getElementById(`audio-${cardId}`);
    if (audio) {
        audio.play().catch(e => console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e));
    }
}
</script>
{% endblock %}